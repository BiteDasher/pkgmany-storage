# Based on https://aur.archlinux.org/cgit/aur.git/tree/PKGBUILD?h=dosbox-x
debname=dosbox-x
debver=0.83.3
debrel=1
year=2020
maintainer="Artemii Sudakov <finziyr@yandex.ru>"
author="Jonathan Campbell"
debdesc="DOSBox-X fork of the DOSBox project"
debarch="amd64"
url='https://github.com/joncampbell123/dosbox-x'
license="GPL"
makedepends=('make' 'freeglut3-dev')
debdeps="libxrandr2, libpng16-16, libxkbfile1, fluidsynth, mesa-utils, ffmpeg"
debcon="dosbox-x-git"
sources=("wget:dosbox-x.tar.gz:https://github.com/joncampbell123/dosbox-x/archive/dosbox-x-v${debver}.tar.gz"
	"wget:dosbox-x.png:https://github.com/joncampbell123/dosbox-x/raw/master/src/dosbox.png")
sha256sums=("48f005949ada1ace8ad8c00bb27fad17d566e5bcdbec8be6078e44f8ad04759a"
	    "e6fd580ff55b617d1969bc7fe78ae4da3b14ced8d36c00b6b4b06913a0806233")
unpack() {
  tar -xf "$srcdir/dosbox-x.tar.gz" -C $srcdir/
}
addfiles() {
cat <<EOF > $srcdir/dosbox-x.desktop
[Desktop Entry]
Type=Application
Name=DOSBox-X
GenericName=DOS Emulator
GenericName[es]=Emulador de DOS
Comment=Run DOS games and apps
Comment[es]=Ejecuta juegos y aplicaciones DOS
Exec=dosbox-x
Icon=dosbox
Terminal=false
Categories=Game;Emulator
EOF
}
package() {
  cd $srcdir/dosbox-x-dosbox-x-v${debver}
  export LDFLAGS="${LDFLAGS//,--as-needed}"
  sed -i -e 's/-j3/-j$(nproc)/g' build
  ./build
  make DESTDIR="${pkgdir}" install
  install -Dm755 $srcdir/dosbox-x.desktop $pkgdir/usr/share/applications/dosbox-x.desktop
  install -Dm644 $srcdir/dosbox-x.png $pkgdir/usr/share/pixmaps/dosbox-x.png
}
